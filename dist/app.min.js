var host=$(location).attr("host");function remapBreadcrumb(breadcrumb){new_breadcrumb_html="";for(var i=0;i<breadcrumb.length;i++){url_category=[];for(var j=0;j<=i;j++){url_category[j]=breadcrumb[j]}new_breadcrumb_html+='<span class="breadcrumb-child" itemprop="child" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"><a class="breadcrumb-child-link" href="http://'+host+"/archive/category/"+url_category.join("-")+'" itemprop="url"><span itemprop="title">'+breadcrumb[i]+"</span></a></span>";if(i+1<breadcrumb.length){new_breadcrumb_html+='<span class="breadcrumb-gt"> &gt;</span>'}}if(new_breadcrumb_html!=""){$("#top-box > div.breadcrumb > div.breadcrumb-inner > span.breadcrumb-child:first").prop("outerHTML",new_breadcrumb_html)}}function remapArticleCategory(categories){var index=0;while(typeof categories[index+1]!="undefined"&&categories[index+1].text.includes("-")){index+=1}breadcrumb_array=categories[index].text.split("-");remapBreadcrumb(breadcrumb_array);category_num=categories.length;for(var i=0;i<category_num;i++){category_branch=categories[i].text.split("-");categories[i].text=category_branch[category_branch.length-1]}}function remapCategoryBreadcrumb(breadcrumb){new_breadcrumb_html="";for(var i=0;i<breadcrumb.length;i++){if(i+1<breadcrumb.length){url_category=[];for(var j=0;j<=i;j++){url_category[j]=breadcrumb[j]}new_breadcrumb_html+='<span class="breadcrumb-child" itemprop="child" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"><a class="breadcrumb-child-link" href="http://'+host+"/archive/category/"+url_category.join("-")+'" itemprop="url"><span itemprop="title">'+breadcrumb[i]+"</span></a></span>";new_breadcrumb_html+='<span class="breadcrumb-gt"> &gt;</span>'}else{new_breadcrumb_html+='<span class="breadcrumb-child" itemprop="child" itemscope itemtype="http://data-vocabulary.org/Breadcrumb">'+breadcrumb[i]+"</span>"}}if(new_breadcrumb_html!=""){$("#top-box > div.breadcrumb > div.breadcrumb-inner > span.breadcrumb-child:first").prop("outerHTML",new_breadcrumb_html)}}function remapArchiveCategory(categories){for(var i=0;i<categories.length;i++){category_branch=categories[i].text.split("-");categories[i].text=category_branch[category_branch.length-1]}}$(document).ready(function(){var $entry_categories=$("#main-inner > article.entry > div.entry-inner > header > div.entry-categories > a");if($entry_categories.length>0){remapArticleCategory($entry_categories)}var $archive_entries=$("#main-inner > div.archive-entries");if($archive_entries.length>0){$breadcrumb_child=$("#top-box > div.breadcrumb > div.breadcrumb-inner > span.breadcrumb-child:first");breadcrumbs=$breadcrumb_child.find("span").text().split("-");remapCategoryBreadcrumb(breadcrumbs);$archive_entries.each(function(){remapArchiveCategory($(this).find("section > div.categories > a"))})}});var $hatena_module_category=$("div.hatena-module-category");var parent_level=1;$all_li=$hatena_module_category.find("li");function processArchive(idx,plevel,$ul){flag=true;while(idx<$all_li.length){$li=$($all_li[idx]);$a=$li.find("a");category_name=$a.text();breadcrumb=category_name.split("-");level=breadcrumb.length;if(level==1&&idx>0){$li.attr("class","on-border")}if(level<plevel){if(plevel>2){$($all_li[idx-1]).css("padding-bottom","0px")}return idx-1}else if(level==plevel){$a.text(breadcrumb[level-1]);if($ul!=null){$li.appendTo($ul)}else{$opend_span=$('<span class="hatena-breadcrumb-plus-toggle-button" id="opend-'+idx+'">▼</span>');$closed_span=$('<span class="hatena-breadcrumb-plus-toggle-button" id="closed-'+idx+'">▶</span>');$closed_span.css("visibility","hidden");$opend_span.css("display","none");$li.prepend($closed_span);$li.prepend($opend_span)}}else{id=idx-1;ulid="hatena-breadcrumb-plus-toggle-"+id;$new_ul=$('<ul id="'+ulid+'" type="square"></ul>');if(level>2){$new_ul.attr("class","hatena-breadcrumb-plus-child2")}else{$new_ul.attr("class","hatena-breadcrumb-plus-child1");$new_ul.css("display","none")}$($all_li[id]).append($new_ul);$("#closed-"+id).css({visibility:"visible",display:"inline"});$("#opend-"+id).on("click",{_id:id,_toggle:"close"},toggleCategory);$("#closed-"+id).on("click",{_id:id,_toggle:"open"},toggleCategory);idx=processArchive(idx,level,$new_ul)}idx+=1}return idx}function toggleCategory(e){if(e.data._toggle=="close"){$("#hatena-breadcrumb-plus-toggle-"+e.data._id).toggle();$("#closed-"+e.data._id).toggle();$("#opend-"+e.data._id).toggle()}else if(e.data._toggle=="open"){$("#hatena-breadcrumb-plus-toggle-"+e.data._id).toggle();$("#opend-"+e.data._id).toggle();$("#closed-"+e.data._id).toggle()}}$(document).ready(function(){if(typeof $hatena_module_category!="undefined"){processArchive(0,1,null)}});$("span[id^=closed-]").ready(function(){$("span[id^=closed-]").click()});